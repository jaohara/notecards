{% extends 'notecards/base.html' %}

{% load staticfiles %}

{% block menu %}
{% endblock %}

{% block feedback %}
    <div class="feedback-{{feedback_type}}">{{quiz_results}}</div>
{% endblock %}

{% block content %}
    <script src="{% static 'js/notecards-deck-view-jquery.js' %}"></script>

    <div class="deck-meta">

        <div class="deck-meta-top-pane">
        <h1>{{deck.title}}</h1>
        <div class="deck-controls">
            {% if user == deck.author %}
            <a href="{% url 'edit_deck' pk=deck.pk %}">
                <span class="glyphicon glyphicon-pencil"></span>
                <span class="deck-edit">Edit</span>
            </a>
            {% endif %}
            {% if deck.card_count > 1 %}
            <a href="{% url 'deck_review' pk=deck.pk card_index=0 %}">
                <span class="glyphicon glyphicon-book"></span>
                <span class="deck-review">Review</span>
            </a>
            {% else %}
            <a href="">
                <span class="glyphicon glyphicon-book"></span>
                <span class="deck-review unclickable" tooltip="At least 2 cards are needed to review.">Review</span>
            </a>
            {% endif %}

            {% if deck.card_count >= 4 %}
            <a href="{% url 'deck_quiz' deck_pk=deck.pk %}">
                <span class="glyphicon glyphicon-question-sign"></span>
                <span class="deck-quiz">Quiz</span>
            </a>
            {% else %}
            <a href="">
                <span class="glyphicon glyphicon-question-sign"></span>
                <span class="deck-quiz unclickable" tooltip="At least 4 cards are needed to make a Quiz.">Quiz</span>
            </a>
            {% endif %}
        </div>
        </div>

        <p>
            <span class="deck-origin">Created by {{deck.author}} on {{deck.created_date}}</span>
            <!--<span class="deck-origin">Modified on {{deck.modified_date}}</span>-->
        </p>


        {% if deck.description|length > 0 %}
        <p class="deck-description">{{deck.description}}</p>
        {% endif %}

        <form method="POST" class="tag-form" action="{% url 'add_tag_to_deck' pk=deck.pk%}">
            <p class="deck-tags">
                <strong>Tags:</strong>

                {% if deck.tags %}
                    {% for tag in deck.tags.all %}
                        <span class="deck-tag">
                            <a href="{% url 'tag_deck_list' tag_word=tag.word %}">{{tag.word}}</a>
                            <a href="{% url 'remove_tag_from_deck' pk=deck.pk tag_word=tag.word%}">
                            <span class="glyphicon glyphicon-remove"></span></a>
                        </span>
                    {% endfor %}
                {% else %}
                    None
                {% endif %}

                {% if user == deck.author %}
                        {% csrf_token %}
                        {{tag_form}}<a class="tag-input-toggle"href=""><span class="glyphicon glyphicon-plus"></span></a>
                {% endif %}
        </p>
        </form>
    </div>
    <div class="deck-wrapper">

        {% for card in cards %}

            {% if user == deck.author %}
            <a class="card-edit-link" href="{% url 'edit_card' deck_pk=deck.pk card_pk=card.pk %}">
            {% endif %}

        <div class="card-wrapper">

            <div class="front">{{card.front}}</div>
            <div class="back">{{card.back}}</div>

        </div>

            {% if user == deck.author %}
            </a>
            {% endif %}

        {% empty %}

        <div class="deck-warning">
            <p><span class="glyphicon glyphicon-info-sign"></span> This deck doesn't contain any cards.</p>
        </div>

        {% endfor %}

    </div>

    {% if user.is_authenticated and user == deck.author %}
    <h2>Add a Card</h2>
    <form method="POST" class="card-form" action="{% url 'add_card_to_deck' pk=deck.pk%}">
        {% csrf_token %}
        {{ card_form }}
        <button type="submit" class="save btn btn-default">Add to Deck</button>
    </form>
    {% endif %}
{% endblock %}